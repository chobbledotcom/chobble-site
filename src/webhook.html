---
permalink: "/webhook/"
---

<!doctype html>
<html>
  <head>
    <title>SEO Diagnosis</title>
    <meta name="robots" content="noindex" />
    <style>
      body {
        font-family: sans-serif;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        height: 100vh;
        gap: 0.5rem;
        box-sizing: border-box;
        margin: 0;
      }
      textarea {
        flex: 1;
        padding: 0.5rem;
        font-family: monospace;
        font-size: 14px;
        transition: opacity 0.2s;
      }
      textarea.waiting {
        opacity: 0.4;
      }
      .row {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }
      input {
        flex: 1;
        padding: 0.5rem;
      }
      button {
        padding: 0.5rem 1rem;
        background: #3b82f6;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:disabled {
        opacity: 0.5;
      }
      #timer {
        font-size: 14px;
        color: #666;
        min-width: 180px;
      }
    </style>
  </head>
  <body>
    <textarea id="html-input" placeholder="Paste HTML here..."></textarea>
    <div class="row">
      <input type="text" id="secret-key" placeholder="Secret Key" />
      <button id="btn" onclick="postHtml()">Diagnose</button>
      <span id="timer"></span>
    </div>
    <textarea
      id="response"
      placeholder="Response will appear here..."
      readonly
    ></textarea>

    <script>
      // Request notification permission on page load
      if ("Notification" in window && Notification.permission === "default") {
        Notification.requestPermission();
      }

      // Pre-fill secret key from hash if present
      (function () {
        const hash = window.location.hash;
        if (hash && hash.startsWith("#key=")) {
          const key = hash.substring(5);
          document.getElementById("secret-key").value = key;
        }
      })();

      function isValidGuid(str) {
        return /^[a-f0-9-]{36}$/i.test(str);
      }

      function showNotification(success) {
        if ("Notification" in window && Notification.permission === "granted") {
          new Notification("SEO Diagnosis", {
            body: success ? "Request completed!" : "Request failed!",
            icon: success ? undefined : undefined,
          });
        }
      }

      let timerInterval = null;

      async function postHtml() {
        const btn = document.getElementById("btn");
        const secretKey = document.getElementById("secret-key").value.trim();
        const html = document.getElementById("html-input").value;
        const responseBox = document.getElementById("response");
        const timerEl = document.getElementById("timer");

        if (!isValidGuid(secretKey)) {
          responseBox.value =
            "Error: Invalid secret key. Must be a valid GUID (36 characters, containing a-f, 0-9, and dashes).";
          return;
        }

        const endpoint = `https://auto.chobble.com/webhooks/flows/${secretKey}/sync`;

        btn.disabled = true;
        btn.textContent = "Diagnosing...";
        responseBox.classList.add("waiting");

        // Start timer
        const startTime = Date.now();
        timerInterval = setInterval(() => {
          const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
          timerEl.textContent = `Waiting for response (${elapsed}s)`;
        }, 100);

        let success = false;
        try {
          const res = await fetch(endpoint, {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: html,
          });
          responseBox.value = await res.text();
          success = true;
        } catch (e) {
          responseBox.value = "Error: " + e.message;
        }

        // Stop timer and show final time
        clearInterval(timerInterval);
        const finalTime = ((Date.now() - startTime) / 1000).toFixed(1);
        timerEl.textContent = `Completed in ${finalTime}s`;

        responseBox.classList.remove("waiting");
        btn.disabled = false;
        btn.textContent = "Diagnose";

        showNotification(success);
      }
    </script>
  </body>
</html>
